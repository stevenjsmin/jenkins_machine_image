{
  "variables": {
    "access_key": "{{env `GB_AWS_PACKER_ACCESS_KEY`}}",
    "secret_key": "{{env `GB_AWS_PACKER_SECRET_KEY`}}",
    "region": "",
    "source_ami": "",
    "instance_type": "",
    "ssh_username": ""
  },
  "builders": [{
    "type": "amazon-ebs",
    "access_key": "{{user `access_key`}}",
    "secret_key": "{{user `secret_key`}}",
    "region": "{{user `region`}}",
    "source_ami": "{{user `source_ami`}}",
    "instance_type": "{{user `instance_type`}}",
    "ssh_username": "{{user `ssh_username`}}",
    "ami_name": "{{user `ami_name`}}-{{isotime \"2006-01-02\"}}-{{timestamp}}",
    "ssh_timeout": "5m",
    "vpc_id": "{{ user `vpc_id` }}",
    "subnet_id": "{{ user `subnet_id` }}",
    "associate_public_ip_address" : false,
    "ami_users": "{{ user `ami_users` }}",
    "run_tags": {
      "Name": "Cooking Packer AMI Image",
      "exempted_date": "{{user `exempted_date`}}",
      "nbn:applicationSource": "{{user `nbn:applicationSource`}}",
      "nbn:env:code": "{{user `nbn:env:code`}}",
      "nbn:env:subcode": "{{user `nbn:env:subcode`}}",
      "nbn:focalPoint:applicationId": "{{user `nbn:focalPoint:applicationId`}}",
      "nbn:focalPoint:applicationName": "{{user `nbn:focalPoint:applicationName`}}",
      "nbn:focalPoint:applicationShortName": "{{user `nbn:focalPoint:applicationShortName`}}",
      "nbn:focalPoint:sdgCode": "{{user `nbn:focalPoint:sdgCode`}}",
      "nbn:focalPoint:sdgPlatformCode": "{{user `nbn:focalPoint:sdgPlatformCode`}}",
      "nbn:focalPoint:sdgPlatformName": "{{user `nbn:focalPoint:sdgPlatformName`}}",
      "nbn:focalPoint:systemTeamEmail": "{{user `nbn:focalPoint:systemTeamEmail`}}",
      "nbn:focalPoint:systemTeamLead": "{{user `nbn:focalPoint:systemTeamLead`}}",
      "nbn:focalPoint:systemTeamName": "{{user `nbn:focalPoint:systemTeamName`}}",
      "nbn:operationalMode": "{{user `nbn:operationalMode`}}",
      "nbn:teamCode": "{{user `nbn:teamCode`}}",
      "state:scheduleName": "{{user `state:scheduleName`}}"
    },
    "tags": {
      "Name": "{{ user `ami_name` }}",
      "exempted_date": "{{user `exempted_date`}}",
      "nbn:applicationSource": "{{user `nbn:applicationSource`}}",
      "nbn:env:code": "{{user `nbn:env:code`}}",
      "nbn:env:subcode": "{{user `nbn:env:subcode`}}",
      "nbn:focalPoint:applicationId": "{{user `nbn:focalPoint:applicationId`}}",
      "nbn:focalPoint:applicationName": "{{user `nbn:focalPoint:applicationName`}}",
      "nbn:focalPoint:applicationShortName": "{{user `nbn:focalPoint:applicationShortName`}}",
      "nbn:focalPoint:sdgCode": "{{user `nbn:focalPoint:sdgCode`}}",
      "nbn:focalPoint:sdgPlatformCode": "{{user `nbn:focalPoint:sdgPlatformCode`}}",
      "nbn:focalPoint:sdgPlatformName": "{{user `nbn:focalPoint:sdgPlatformName`}}",
      "nbn:focalPoint:systemTeamEmail": "{{user `nbn:focalPoint:systemTeamEmail`}}",
      "nbn:focalPoint:systemTeamLead": "{{user `nbn:focalPoint:systemTeamLead`}}",
      "nbn:focalPoint:systemTeamName": "{{user `nbn:focalPoint:systemTeamName`}}",
      "nbn:operationalMode": "{{user `nbn:operationalMode`}}",
      "nbn:teamCode": "{{user `nbn:teamCode`}}",
      "nbn:ast:ownerName": "{{user `nbn:ast:ownerName`}}",
      "nbn:ast:ownerEmail": "{{user `nbn:ast:ownerEmail`}}",
      "nbn:ast:ownerMobile": "{{user `nbn:ast:ownerMobile`}}"
    }
  }],
  "provisioners" : [
    {
      "type": "shell",
      "inline": [
          "sleep 30",
          "sudo yum update -y",
          "sudo yum install git -y",
          "sudo mkdir -p /local/download;sudo mkdir -p /local/temp",
          "sudo curl -o /local/download/apache-maven-3.5.2-bin.tar.gz https://archive.apache.org/dist/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz"
      ]
    },
    {
      "type": "shell-local",
      "command": "sudo echo 'This is shell execution on the local'"
    },
    {
      "type": "file",
      "source": "/root/temp/uploadTest.txt",
      "destination": "/local/"
    }
  ]
}

